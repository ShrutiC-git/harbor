version: "3.3"

# uffizzi integration
x-uffizzi:
  ingress:
    service: server
    port: 8080

services:

  registry:
    image: "${REGISTRY_IMAGE}"
    container_name: registry
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID

  # signer:
  #   image: "${SIGNER_IMAGE}"
  #   networks:
  #     mdb:
  #     sig:
  #       aliases:
  #         - notarysigner
  #   # entrypoint: /usr/bin/env sh
  #   # command: -c "./migrations/migrate.sh && notary-signer -config=fixtures/signer-config.postgres.json"
  #   environment:
  #     # MIGRATIONS_PATH: migrations/signer/postgresql
  #     DB_URL: postgres://postgres:postgres@localhost:5432
  #   depends_on:
  #     - postgresql

  postgresql:
    image: postgres:latest
    environment:
        - POSTGRES_USER=postgres
        - POSTGRES_PASSWORD=password
    networks:
      - mdb
    volumes:
      # - ./notarysql/postgresql-initdb.d:/docker-entrypoint-initdb.d
      - notary_data:/var/lib/postgresql
    ports:
      - 5432:5432
    command: -l
volumes:
  notary_data:
    external: false

networks:
  mdb:
    external: false
  sig:
    external: false
